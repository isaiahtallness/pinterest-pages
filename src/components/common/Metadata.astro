---
import merge from 'lodash.merge'
import { AstroSeo } from '@astrolib/seo'
import defaultImage from '~/assets/images/default.png'

import type { Props as AstroSeoProps } from '@astrolib/seo'
import { SITE, METADATA, I18N } from 'astrowind:config'
import type { MetaData } from '~/types'
import { getCanonical } from '~/utils/permalinks'
---

const {
  title,
  ignoreTitleTemplate = false,
  canonical = String(getCanonical(String(Astro.url.pathname))),
  robots = {},
  description,
  openGraph = {},
  twitter = {},
} = Astro.props

const seoProps: AstroSeoProps = merge(
  {
    title: '',
    titleTemplate: '%s',
    canonical: canonical,
    noindex: true,
    nofollow: true,
    description: undefined,
    openGraph: {
      url: canonical,
      site_name: SITE?.name,
      images: [
        {
          url: defaultImage.src,
          width: 1200,
          height: 628,
        },
      ],
      locale: I18N?.language || 'en',
      type: 'website',
    },
    twitter: {
      cardType: 'summary_large_image',
    },
  },
  {
    title: METADATA?.title?.default,
    titleTemplate: METADATA?.title?.template,
    noindex: typeof METADATA?.robots?.index !== 'undefined' ? !METADATA.robots.index : undefined,
    nofollow: typeof METADATA?.robots?.follow !== 'undefined' ? !METADATA.robots.follow : undefined,
    description: METADATA?.description,
    twitter: METADATA?.twitter,
  },
  {
    title: title,
    titleTemplate: ignoreTitleTemplate ? '%s' : undefined,
    canonical: canonical,
    noindex: typeof robots?.index !== 'undefined' ? !robots.index : undefined,
    nofollow: typeof robots?.follow !== 'undefined' ? !robots.follow : undefined,
    description: description,
    twitter: twitter,
  }
)
---

<AstroSeo {...seoProps} />

