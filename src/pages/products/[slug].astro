---
import Layout from '../../layouts/Layout.astro';
import fs from 'node:fs/promises';
import path from 'node:path';

export async function getStaticPaths() {
  const dir = path.resolve('./src/content/products');
  const files = await fs.readdir(dir);

  return files.map((file) => {
    const slug = file.replace('.json', '');
    return { params: { slug } };
  });
}

export async function get({ params }) {
  const filePath = path.resolve(`./src/content/products/${params.slug}.json`);
  const raw = await fs.readFile(filePath, 'utf-8');
  const data = JSON.parse(raw);
  return { props: data };
}

const { title, description, image, affiliate_link } = Astro.props;
---

<Layout>
  <section class="max-w-2xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4">{title}</h1>
    <img src={image} alt={title} class="rounded-lg mb-4" />
    <p class="text-lg mb-4">{description}</p>
    <a href={affiliate_link} rel="nofollow" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" target="_blank">
      Buy on Amazon →
    </a>
    <p class="text-sm mt-2 text-gray-400">#ad – I may earn a commission if you purchase through this link.</p>
  </section>
</Layout>
