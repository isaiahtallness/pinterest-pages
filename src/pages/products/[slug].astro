---
/* eslint-disable @typescript-eslint/no-unused-vars */

import Layout from '../../layouts/Layout.astro';
import fs from 'node:fs/promises';
import path from 'node:path';

type Review = {
  id: string;
  title: string;
  body: string;
  stars: number;
};

export async function getStaticPaths() {
  const dir = path.resolve('./src/content/products');
  const files = await fs.readdir(dir);

  return files.map((file) => ({
    params: { slug: file.replace('.json', '') },
  }));
}

export async function getStaticProps({ params }) {
  const filePath = path.resolve(`./src/content/products/${params.slug}.json`);
  const raw = await fs.readFile(filePath, 'utf-8');
  const data = JSON.parse(raw);
  return { props: data };
}

const {
  title,
  description,
  image,
  affiliate_link,
  top_reviews = []
} = Astro.props as {
  title: string;
  description: string;
  image: string;
  affiliate_link: string;
  top_reviews?: Review[];
};
---
